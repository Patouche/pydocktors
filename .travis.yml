language: python

python:
  - 2.7
  - 3.4
  - 3.3
  - 3.5
  - 3.6

sudo: required
services: [docker]

install: pip install -r requirements.txt
script: nosetests -v tests --with-coverage --cover-erase --cover-package docktors

jobs:
  include:
    - stage: Integration Test
      only: [master, developpment]
      script: .ci/integ-tests.sh
    - stage: Github Release
      only: [master]
      script: .ci/release.sh
    - stage: Deploy in PyPi
      only: [master, developpment]
      script:
        - export LIB_VERSION=$(cat VERSION)
        - test $TRAVIS_BRANCH = 'master' && export PYPI_SERVER=pypi || export PYPI_SERVER=testpypi
        - test $TRAVIS_BRANCH != 'master' && echo "${LIB_VERSION}.dev${TRAVIS_JOB_NUMBER%.*}" > VERSION || true
      deploy:
        provider: pypi
        server: https://${PYPI_SERVER}.python.org/pypi
        user: Patouche
        password: $PYPI_PASSWORD
        skip_upload_docs: true
        skip_cleanup: true
        on:
          all_branches: true
